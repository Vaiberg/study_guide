# Шпаргалка по Python SQLite: Базовая информация

## Что такое СУБД и реляционные БД?

**База данных** — это хранилище структурированной информации.

**Реляционные базы данных** — базы, в которых данные представлены в видесвязанных таблиц.

**СУБД (система управления базами данных)** — это комплекс программ, который позволяет создать базу данных, наполнить её новыми таблицами, отобразить содержимое, редактировать существующие таблицы.

**Таблица** — это совокупность строк и столбцов.

**Поле** — столбец таблицы с характеристикой объекта, уникальным именем и характерным типом данных.

**Запись** — строка таблицы, содержащая информацию об одном объекте.

**Ячейка** — место пересечения строки и столбца.

**Первичный ключ** — поле или группа полей, использующиеся для однозначного определения записи. Все значения первичного ключа уникальны.

**SQL (Structured Query Language)** — это язык для работы с данными в реляционных базах данных. Он позволяет создавать, изменять и управлять данными, а также получать доступ к информации, хранящейся в таблицах базы данных.

**Запрос** — это сформулированное в соответствии с синтаксисом SQL требование, в котором объявляют, какие данные выбрать, и как именно их обработать.

**API (Application Programming Interface)** — это набор правил и инструментов, который позволяет программам взаимодействовать между собой. Он определяет, как одна программа может запросить данные или вызвать функции в другой.

**API и Базы Данных** <br>

**Связь с БД:** `API` может выполнять запросы к базе данных от лица клиента. Например, когда приложение запрашивает информацию о пользователе, `API` отправляет запрос к базе данных, обрабатывает данные и возвращает ответ клиенту.

**Роль API:** Он выполняет роль "посередине" между базой данных и пользователями, обеспечивая безопасный доступ к данным, а также может выполнять бизнес-логику.

**Взаимодействие с СУБД:** `API` управляет доступом к СУБД. Когда пользователь хочет получить данные, `API` формирует `SQL`-запросы, выполняет их в базе данных и возвращает данные клиенту в удобном формате (например, `JSON`).

## Популярные СУБД для Python

1. `SQLite`

    **Описание:** Легковесная встраиваемая СУБД, не требует отдельного сервера.

    **Использование:** Встраивается в приложения, подходит для разработки прототипов, мобильных приложений и небольших проектов.

    **Подключение в Python:** sqlite3 (встроенный модуль).

    **Плюсы:** Простота, встроенность в Python, не требует настроек.

    **Минусы:** Ограниченные функции для работы с большими объемами данных.

    https://sqlitebrowser.org/

2. `MySQL`

    **Описание:** Серверная СУБД, популярная в веб-разработке.

    **Использование:** Широко используется для крупных веб-приложений, электронной коммерции, социальных сетей.

    **Подключение в Python:** Через библиотеки `mysql-connector-python`, `PyMySQL` или `SQLAlchemy` (ORM).

    **Плюсы:** Высокая производительность, поддержка сложных запросов.

    **Минусы:** Сложность настроек, ограниченная поддержка расширенных типов данных.

3. `PostgreSQL`

    **Описание:** Мощная, расширяемая СУБД с поддержкой сложных типов данных.

    **Использование:** Используется для аналитических систем, финансовых приложений, крупных проектов с интенсивной нагрузкой.

    **Подключение в Python:** `psycopg2`, `asyncpg` (асинхронный доступ), или `SQLAlchemy`.

    **Плюсы:** Поддержка `JSON`, массивов, сложных запросов, транзакций и расширений (например, для геоданных).

    **Минусы:** Требует больше ресурсов для обслуживания.

4. `MongoDB`

    **Описание:** Документо-ориентированная `NoSQL` СУБД, хранит данные в формате `JSON`-подобных документов.

    **Использование:** Подходит для приложений, работающих с неструктурированными или динамически изменяемыми данными (например, интернет-магазины).

    **Подключение в Python:** `pymongo`.

    **Плюсы:** Гибкость схемы, масштабируемость.

    **Минусы:** Не поддерживает транзакции в полном объеме, может потребовать больше места для хранения данных.

5. `Redis`

    **Описание:** СУБД в оперативной памяти (in-memory), используется как кеш, база данных или брокер сообщений.

    **Использование:** Часто используется для кэширования данных, брокеров сообщений, создания очередей задач.

    **Подключение в Python:** `redis-py`.

    **Плюсы:** Высокая скорость, поддержка структур данных (списки, множества, хеши).

    **Минусы:** Ограничена размером оперативной памяти, данные могут быть потеряны при сбое (если не включена запись на диск).

6. `Cassandra`

    **Описание:** Распределенная СУБД для работы с большими объемами данных и поддержкой масштабируемости.

    **Использование:** Подходит для приложений с большим количеством записей (например, логи, мониторинг).

    **Подключение в Python:** `cassandra-driver`.

    **Плюсы:** Высокая отказоустойчивость, масштабируемость.

    **Минусы:** Требует сложной настройки, не поддерживает традиционные реляционные отношения.

7. `MariaDB`

    **Описание:** Форк `MySQL`, создан для повышения производительности и отказоустойчивости.

    **Использование:** Альтернатива `MySQL`, активно используется в веб-приложениях и аналитике.

    **Подключение в Python:** `mysql-connector-python`, `PyMySQL`.

    **Плюсы:** Совместимость с `MySQL`, высокая производительность.

    **Минусы:** Ограниченная поддержка некоторых сложных функций `PostgreSQL`.

8. `Oracle Database`

    **Описание:** Мощная корпоративная СУБД, поддерживающая масштабируемые и безопасные транзакционные системы.

    **Использование:** Применяется в финансовом и государственном секторе, где важны надежность и безопасность.

    **Подключение в Python:** `cx_Oracle`.

    **Плюсы:** Высокая безопасность, поддержка распределенных баз данных.

    **Минусы:** Платная лицензия, сложность настроек.

9. `Microsoft SQL Server`

    **Описание:** СУБД от Microsoft, популярная в корпоративной среде.

    **Использование:** Корпоративные приложения, аналитика, взаимодействие с другими продуктами Microsoft.

    **Подключение в Python:** `pyodbc`, `pymssql`.

    **Плюсы:** Интеграция с экосистемой Microsoft, высокая производительность.

    **Минусы:** Преимущественно платная, сложная настройка.

## Рекомендации для выбора СУБД
Для разработки и прототипов: `SQLite`. <br>
Для веб-приложений с большими нагрузками: `MySQL`, `PostgreSQL`.<br>
Для аналитики и сложных данных: `PostgreSQL`.<br>
Для работы с документами и `NoSQL`: `MongoDB`.<br>
Для кэширования и очередей задач: `Redis`.<br>
Для распределенных систем с большой нагрузкой: `Cassandra`.<br>

## Подключение к БД

**Импорт модуля `sqlite3`**

Для работы с `SQLite` в Python необходимо импортировать модуль `sqlite3`. Это стандартный модуль, входящий в состав Python.
```python
import sqlite3
```
Можно задать для модуля синоним, чтобы упростить запись:
```python
import sqlite3 as sq
```

**Метод `connect()`**

Метод `connect()` используется для установки соединения с базой данных.

```python
con = sqlite3.connect('имя_файла.db')
```

`con` в методе `connect` — это просто имя переменной, в которой сохраняется объект соединения с базой данных. Это может быть любое имя, но обычно используют сокращения вроде `con` (от "connection") или `conn` для ясности кода.


Другими словами, мы создаем объект соединения, который управляет доступом к базе данных. Этот объект `con` позволяет нам взаимодействовать с базой через курсор `cursor` и выполнять запросы `execute`, а также управлять транзакциями (например, `commit`, `rollback`).



`имя_файла.db` — имя файла базы данных SQLite.

- Если указанный файл базы данных уже существует, `connect()` просто подключится к этой базе.

- Если база данных отсутствует, `connect()` создаст новый файл с указанным именем и расширением `.db`.

- Файл базы данных SQLite представляет собой файл `.db`, но допустимы и другие расширения, такие как `.db3`, `.sqlite` или `.sqlite3`.

- Если указан только имя файла, он будет создан в текущей директории.

- Если указан полный путь к файлу (например, `/path/to/database.db`), база будет создана по этому пути.

**Метод `close()`**

Метод `close()` используется для закрытия соединения с базой данных.

```python
con.close()
```
- Закрытие соединения освобождает ресурсы.

- Важно всегда закрывать соединение, когда оно больше не нужно, чтобы предотвратить утечку памяти и другие проблемы.

**Метод `cursor()`**

Метод `cursor()` создает объект-курсор, с помощью которого можно выполнять SQL-запросы.

- Курсор — это объект, который управляет и выполняет SQL-запросы.

- Он позволяет отправлять SQL-команды в базу данных и управлять результатами запросов.

**Метод `execute()`**

Метод `execute()` используется для выполнения SQL-запросов.

```python
cur.execute('SQL-команда', параметры)
```

- SQL-команда — строка с запросом SQL, который нужно выполнить (например, создание таблицы, добавление данных и т.д.).

- параметры — не обязательны, но их можно использовать для подстановки значений в запрос.

- Этот метод позволяет выполнять различные SQL-запросы, такие как создание таблиц, вставка данных, выборка данных и т. д.

```python
cur.execute('CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY, name TEXT)')
cur.execute('INSERT INTO users (name) VALUES (?)', ('Alice',))
```

**Контекстный менеджер `with`**

Использование конструкции `with` для работы с SQLite упрощает код и делает его более безопасным:

- Автоматическое закрытие соединения: Контекстный менеджер автоматически закрывает соединение, когда блок кода завершается. Это предотвращает утечки памяти.

- Обработка ошибок: Если внутри блока with происходит ошибка, Python гарантирует, что соединение с базой данных все равно будет закрыто корректно.

```python
with sqlite3.connect('test.db') as con:
    cur = con.cursor()
    cur.execute('SQL-команда')
    # любые другие SQL-запросы
# соединение закрывается автоматически
```

Пример использования `with`:
```python
import sqlite3

# Подключение к базе данных с помощью контекстного менеджера `with`
with sqlite3.connect('test.db') as con:
    cur = con.cursor()
    cur.execute('CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY, name TEXT)')
    cur.execute('INSERT INTO users (name) VALUES (?)', ('Alice',))
    cur.execute('SELECT * FROM users')

    # Вывод данных
    for row in cur.fetchall():
        print(row)
# По завершении блока `with` соединение закрывается автоматически
```

Хотя `with` упрощает работу, его можно не использовать. Однако, в этом случае нужно самостоятельно закрывать соединение с помощью `close()`.

Аналогичный пример, без использования `with`:

```python
import sqlite3

# Подключение к базе данных
con = sqlite3.connect('test.db')
cur = con.cursor()

# SQL-команды
cur.execute('CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY, name TEXT)')
cur.execute('INSERT INTO users (name) VALUES (?)', ('Alice',))
cur.execute('SELECT * FROM users')

# Вывод данных
for row in cur.fetchall():
    print(row)

# Закрытие соединения вручную
con.close()
```
**Важно: Без `with` есть риск забыть закрыть соединение, что может привести к утечке ресурсов!**

## Типы данных в таблице SQLite, форматы и их особенности

SQLite поддерживает несколько типов данных, которые можно использовать при создании таблиц. Вот основные из них:

Тип данных | Описание
-----------|------------
`INTEGER`    | Целые числа, могут использоваться для ID и счетчиков.
`REAL`       | Числа с плавающей точкой, для хранения дробных чисел.
`TEXT`       | Текстовые строки, такие как имена или описания.
`BLOB`       | Данные, которые не будут интерпретироваться SQLite, например, изображения или бинарные файлы.
`NULL`       | Представляет отсутствующее значение.

SQLite использует динамическую типизацию. Это значит, что значения в одной колонке могут быть разного типа, даже если тип был определен при создании таблицы. Например, можно сохранить строку в колонке `INTEGER`, хотя это не рекомендуется.

## Принятые правила написания кода на языке SQL

Для повышения читаемости и удобства работы с кодом рекомендуется соблюдать следующие правила:

- Ключевые слова SQL (например, `SELECT`, `FROM`, `WHERE`, `CREATE`, `INSERT`) пишутся заглавными буквами. Это помогает быстро отличить команды SQL от других элементов кода.

- Названия таблиц и столбцов пишутся строчными буквами, но могут быть разделены подчеркиванием (например, `user_name`, `order_date`).

- Отступы: Рекомендуется использовать 4 пробела для каждого уровня отступа. Это помогает структурировать запросы и делает их более читаемыми.

- Запросы разделяются на несколько строк, если они слишком длинные, чтобы улучшить читаемость.

- Используйте `--` для однострочных комментариев в SQL коде.

- Ограничители (`PRIMARY KEY`, `NOT NULL`, `DEFAULT`) пишутся после типа данных для более четкой структуры.

```SQL
-- Это однострочный комментарий
SELECT user_name, user_email
FROM users
WHERE user_age > 21
ORDER BY user_name;
```

## Создание и удаление таблиц

Создание таблицы в SQLite выполняется с помощью команды `CREATE TABLE`. Основной синтаксис выглядит так:

```sql
CREATE TABLE [IF NOT EXISTS] table_name (
    column1 datatype [CONSTRAINTS],
    column2 datatype [CONSTRAINTS],
    ...
);

-- В квадратные скобки заключены необязательные части синтаксиса, которые можно включать или пропускать.
```

Пример команды для создания таблицы с несколькими типами данных и ограничениями:

```python
cur.execute('''CREATE TABLE IF NOT EXISTS users (
    user_id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    sex INTEGER NOT NULL DEFAULT 1,
    old INTEGER,
    score INTEGER
)''')
```

- `PRIMARY KEY`: Указывает, что столбец будет уникальным идентификатором записи. Он помогает избежать дублирования и позволяет быстро находить определенные записи. В каждой таблице можно задать только один `PRIMARY KEY`, также, он не может быть пустым `NULL`.

    Cуществуют другие типы ключей, например:

    - `UNIQUE` — обеспечивает уникальность значений в столбце, но позволяет иметь несколько NULL значений.

    - `FOREIGN KEY` — связывает одну таблицу с другой. Используется для установления ссылок между таблицами.

- `AUTOINCREMENT`: используется для автоматического увеличения значения столбца с типом `INTEGER PRIMARY KEY` на единицу для каждой новой записи.
    - Например, если первая запись получает user_id = 1, следующая запись получит user_id = 2, и так далее.
    - Увеличение всегда происходит на +1, обеспечивая непрерывную нумерацию записей, что удобно для уникальной идентификации.

    Важно: В SQLite `AUTOINCREMENT` не обязателен — без него база данных также увеличивает значение, если столбец имеет тип `INTEGER PRIMARY KEY`. Однако `AUTOINCREMENT` гарантирует, что значения не будут повторяться даже после удаления записей.

- `NOT NULL`: Указывает, что столбец не может содержать NULL (пустое) значение.
- `DEFAULT`: Указывает значение по умолчанию, если при вставке записи не указано значение для этого столбца.
- `CHECK`: Проверяет соответствие значению условию, например, возраст больше нуля (age > 0).
- `IF NOT EXISTS` — создаст таблицу только если ее нет.
- Если таблица уже существует и нужно пересоздать, нужно предварительно выполнить команду удаления.

Чтобы добавить запись в таблицу, используется команда `INSERT INTO`.

```python
cur.execute('''INSERT INTO users (name, sex, old, score)
               VALUES (?, ?, ?, ?)''', ('Alice', 1, 30, 85))
```

- `VALUES (?, ?, ?, ?)` — это места для значений, которые передаются в запрос через параметры.
- Используется параметризация для безопасного вставления данных и предотвращения SQL инъекций.

    SQL-инъекция — это тип атаки, когда злоумышленник вводит в запрос вредоносный код. Если передавать в запрос данные напрямую, такие как `cur.execute(f"SELECT * FROM users WHERE name='{username}'")`, то злоумышленник может ввести код, нарушающий безопасность.
    ```python
    username = "'; DROP TABLE users; --"
    cur.execute(f"SELECT * FROM users WHERE name='{username}'")
    ```
    Если передать такое значение в запрос, это может привести к удалению таблицы `users`.

Чтобы удалить таблицу, используется команда `DROP TABLE`:

```python
cur.execute('DROP TABLE IF EXISTS users')
```

- `DROP TABLE` — команда для удаления таблицы.
- `IF EXISTS` — условие, которое предотвращает ошибку, если таблица не существует.

Пример кода для удаления таблицы и работы с другими командами:

```python
import sqlite3

# Создаем соединение с базой данных
con = sqlite3.connect('test.db')
cur = con.cursor()

# Удаляем таблицу, если она существует
cur.execute('DROP TABLE IF EXISTS users')

# Создаем новую таблицу
cur.execute('''CREATE TABLE IF NOT EXISTS users (
    user_id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    sex INTEGER NOT NULL DEFAULT 1,
    old INTEGER,
    score INTEGER
)''')

# Добавляем запись
cur.execute('''INSERT INTO users (name, sex, old, score)
               VALUES (?, ?, ?, ?)''', ('Bob', 2, 25, 90))

# Сохраняем изменения
con.commit()

# Закрываем соединение
con.close()
```


1. Типы данных в таблице sqlite, форматы и их особенности

2. Принятые правила написания кода на языке SQL (например, что пишется заглавными, а что строчными буквами, отступы, как сделать высокую читаемость и т.д) Применяй эти правила, но  расскажи о них в конце шпоргалки

3. команда создания таблицы, синтаксис, примеры внутри cur.execute(), с разными типами данных плюс указать вариации при создании с ограничителям, например с NOT NUL, default и т.д. указать какие бывают и как используются.

Как лучше объявять их? с примерами

что такое primary key, синтаксис и зачем используется простыми словами

что такое autoincrement? синтаксис, зачем используется и нужен ли вообще

Должны быть вариации кода, если таблицы не существует и если существует.


4. Добавление записи в таблицу из примера который ты привел выше в программе DB browser for sqlite. Кратко описать что за программа, зачем нужна и как используется разработчиками

5. команда удаления таблицы, синтаксис, примеры внутри cur.execute()

